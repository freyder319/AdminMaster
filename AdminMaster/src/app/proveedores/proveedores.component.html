<div class="with-sidebar">
  <header>
    <app-admin-navbar></app-admin-navbar>
  </header>

  <main>
  <!-- Vista normal (solo cuando NO estoy en agregar NI modificar) -->
  <div *ngIf="!mostrarAddProveedor && !mostrarModificarProveedor">

    <!-- Título -->
    <section>
      <div class="container text-center">
        <div class="row">
          <div class="col">
            <h1 class="tit-proveedores">
              <i class="bi bi-truck-front-fill me-2"></i>
              <span>Proveedores</span>
            </h1>
          </div>
        </div>
      </div>
    </section>

    <br>

    <!-- Busqueda y Agregar -->
    <section>
      <div class="container buscar-agg">
        <div class="row">
          <!-- Buscar -->
          <div class="col-sm-12 col-md-6 col-lg-6">
            <div class="search">
              <div class="input-group">
                <input type="text" class="form-control" placeholder="Buscar Proveedor..." id="search-input" (input)="onSearch($any($event.target).value)">
              </div>
            </div>
          </div>

          <!-- Agregar Proveedor -->
          <div class="col-sm-12 col-md-6 col-lg-6">
            <div class="agg-provee">

              <!-- Para pantallas grandes (≥768px) → abre offcanvas -->
              <button class="btn agregar d-none d-md-inline-block" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasAddProveedor" aria-controls="offcanvasAddProveedor">
                <span class="texto">Agregar Proveedor</span>
                <img width="80px" src="/assets/img/icono_proveedor/Proveedores__6_-removebg-preview (2).png" alt="">
              </button>

              <!-- Para pantallas pequeñas (<768px) → cambia de interfaz -->
              <button class="btn agregar d-md-none" type="button" (click)="mostrarAddProveedor = true">
                <span class="texto">Agregar Proveedor</span>
                <img width="80px" src="/assets/img/icono_proveedor/Proveedores__6_-removebg-preview (2).png" alt="">
              </button>

            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Tablas Informacion -->
    <section>
      <div class="container">
        <table class="table table-bordered">
          <thead class="table-secondary">
            <tr>
              <th>Nombre Empresa</th>
              <th>NIT / Documento</th>
              <th>Persona de Contacto</th>
              <th>Correo de Empresa</th>
              <th>Teléfono</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody *ngIf="(filteredProveedores$ | async) as list">
            <tr *ngFor="let p of list" [ngClass]="{'fila-inactiva': !p.activo}">
              <td data-label="Nombre Empresa">
                <!-- Solo visible en móviles (<768px), clickeable -->
                <div class="perfil clickable d-md-none" (click)="seleccionar(p); mostrarModificarProveedor = true">
                  <img src="/assets/img/icons-navbar/Proovedores.png" alt="Proveedor">
                  <div class="info">
                    <p class="nombre">
                      <strong>{{ p.nombreEmpresa || '-' }}</strong>
                    </p>
                    <p class="correo">{{ p.correo }}</p>
                  </div>
                </div>

                <!-- Solo visible en escritorio (≥768px), NO clickeable -->
                <div class="perfil d-none d-md-flex">
                  <img src="/assets/img/icons-navbar/Proovedores.png" alt="Proveedor" width="50px" height="50px" style="margin-top: -10px;">
                  <div class="info">
                    <p class="nombre" style="margin-left: 10px;">
                      <strong>{{ p.nombreEmpresa || '-' }}</strong>
                    </p>
                  </div>
                </div>
              </td>

              <td data-label="NIT / Documento">{{ p.nit || '-' }}</td>

              <td data-label="Persona de contacto">
                {{ p.contactoNombre || '-' }}
              </td>

              <td data-label="Correo">{{ p.correo }}</td>
              <td data-label="Teléfono">{{ p.telefono }}</td>
              <td data-label="Estado">
                <span class="status" [ngClass]="p.activo ? 'activo' : 'inactivo'">{{ p.activo ? 'Activo' : 'Inactivo' }}</span>
              </td>
              <td data-label="Acciones" class="acciones">

                <!-- Botones con texto (solo ≥1200px) -->
                <div class="d-none d-xl-flex gap-2">
                  <ng-container *ngIf="!p.activo; else accionesActivoTexto">
                    <button class="btn modificar d-none d-md-inline-block" type="button" (click)="seleccionar(p)" data-bs-toggle="offcanvas" data-bs-target="#offcanvasModifyProveedor" aria-controls="offcanvasModifyProveedor">
                      <i class="bi bi-pencil-square"></i>
                      <span class="texto">Modificar</span>
                    </button>
                    <button class="btn habilitar" (click)="habilitarProveedor(p)">
                      <i class="bi bi-check2-circle"></i>
                      Habilitar
                    </button>
                  </ng-container>
                  <ng-template #accionesActivoTexto>
                    <button class="btn modificar d-none d-md-inline-block" type="button" (click)="seleccionar(p)" data-bs-toggle="offcanvas" data-bs-target="#offcanvasModifyProveedor" aria-controls="offcanvasModifyProveedor">
                      <i class="bi bi-pencil-square"></i>
                      <span class="texto">Modificar</span>
                    </button>
                    <button *ngIf="!isProveedorEnUso(p)" class="btn elimi" (click)="onEliminar(p.id)">
                      <i class="bi bi-trash"></i>
                      Eliminar
                    </button>
                    <button *ngIf="isProveedorEnUso(p)" class="btn inhabilitar" (click)="inhabilitarProveedor(p)">
                      <i class="bi bi-slash-circle"></i>
                      Inhabilitar
                    </button>
                  </ng-template>
                </div>

                <!-- Botones con íconos (768px – 1200px) -->
                <div class="d-none d-md-flex d-xl-none gap-2">
                  <ng-container *ngIf="!p.activo; else accionesActivoIconos">
                    <button class="btn modificar icon-btn d-none d-md-inline-block" title="Modificar" type="button" (click)="seleccionar(p)" data-bs-toggle="offcanvas" data-bs-target="#offcanvasModifyProveedor" aria-controls="offcanvasModifyProveedor">
                      <i class="bi bi-pencil-square"></i>
                    </button>
                    <button class="btn habilitar-icon icon-btn" title="Habilitar" (click)="habilitarProveedor(p)">
                      <i class="bi bi-check2-circle"></i>
                    </button>
                  </ng-container>
                  <ng-template #accionesActivoIconos>
                    <button class="btn modificar icon-btn d-none d-md-inline-block" title="Modificar" type="button" (click)="seleccionar(p)" data-bs-toggle="offcanvas" data-bs-target="#offcanvasModifyProveedor" aria-controls="offcanvasModifyProveedor">
                      <i class="bi bi-pencil-square"></i>
                    </button>
                    <button *ngIf="!isProveedorEnUso(p)" class="btn eliminar-icon icon-btn" title="Eliminar" (click)="onEliminar(p.id)">
                      <i class="bi bi-trash"></i>
                    </button>
                    <button *ngIf="isProveedorEnUso(p)" class="btn inhabilitar-icon icon-btn" title="Inhabilitar" (click)="inhabilitarProveedor(p)">
                      <i class="bi bi-slash-circle"></i>
                    </button>
                  </ng-template>
                </div>
              </td>
            </tr>
            <tr *ngIf="list.length === 0">
              <td colspan="7" class="text-center text-muted py-3">
                {{ lastSearchTerm ? ('No se encontró ningún proveedor para "' + lastSearchTerm + '".') : 'No hay Proveedores registrados' }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

  </div>

  <!-- Vista de Agregar Proveedor en móvil (<768px) -->
  <div *ngIf="mostrarAddProveedor" class="d-md-none">
    <div class="container mt-4 p-3 shadow rounded bg-light">
      <app-add-proveedor (crear)="onCrear($event)"></app-add-proveedor>
      <div class="mt-3">
        <button class="btn btn-volver" type="button" (click)="mostrarAddProveedor = false">
          <i class="bi bi-arrow-left-short"></i> Volver
        </button>
      </div>
    </div>
  </div>

  <!-- Vista de Modificar Proveedor en móvil (<768px) -->
  <div *ngIf="mostrarModificarProveedor" class="d-md-none">
    <div class="container mt-4 p-3 shadow rounded bg-light">
      <app-modify-proveedor [proveedor]="seleccionado" (guardar)="onGuardar($event)"></app-modify-proveedor>
      <div class="mt-3 space">
        <button class="btn btn-volver" type="button" (click)="mostrarModificarProveedor = false">
          <i class="bi bi-arrow-left-short"></i> Volver
        </button>
        <ng-container *ngIf="seleccionado && !seleccionado.activo; else accionesProveedorActivoMovil">
          <button class="btn habilitar" (click)="habilitarProveedor(seleccionado!)">
            <i class="bi bi-check2-circle"></i> Habilitar
          </button>
        </ng-container>
        <ng-template #accionesProveedorActivoMovil>
          <button *ngIf="seleccionado && !isProveedorEnUso(seleccionado)" class="btn eliminar" (click)="onEliminarSeleccionado()">
            <i class="bi bi-trash-fill"></i> Eliminar
          </button>
          <button *ngIf="seleccionado && isProveedorEnUso(seleccionado)" class="btn inhabilitar" (click)="inhabilitarProveedor(seleccionado)">
            <i class="bi bi-slash-circle"></i> Inhabilitar
          </button>
        </ng-template>
    </div>
    </div>
  </div>
  </main>
</div>

<!-- Offcanvas (solo para pantallas grandes) Agregar -->
<div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasAddProveedor" aria-labelledby="offcanvasAddProveedorLabel" (shown.bs.offcanvas)="focusFirstInput('offcanvasAddProveedor')">
  <div class="offcanvas-header">
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Cerrar"></button>
  </div>
  <div class="offcanvas-body">
    <app-add-proveedor (crear)="onCrear($event)"></app-add-proveedor>
  </div>
</div>

<!-- Offcanvas (solo para pantallas grandes) Modificar -->
<div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasModifyProveedor" aria-labelledby="offcanvasModifyProveedorLabel">
  <div class="offcanvas-header">
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Cerrar"></button>
  </div>
  <div class="offcanvas-body">
    <app-modify-proveedor [proveedor]="seleccionado" (guardar)="onGuardar($event)"></app-modify-proveedor>
  </div>
</div>