<div class="with-sidebar">
  <header>
      <app-admin-navbar></app-admin-navbar>
  </header>

  <main>
    <section>

        <div *ngIf="!isAdmin && !cargando && sinTurnoActivo" class="turno-card">
            <h2 class="titulo">Sin turno activo</h2>
            <p>Para comenzar a operar, inicia un turno.</p>
            <button type="button" class="btn-turno" (click)="iniciarTurno()" *ngIf="!isAdmin">Iniciar turno</button>
        </div>

        <div *ngIf="!isAdmin && cargando" class="turno-card">
            <h2 class="titulo">Cargando...</h2>
        </div>

        <div *ngIf="!isAdmin && !cargando && resumen" class="turno-card" [ngClass]="{ 'punto-pos-layout': isPuntoPos }">
            <h2 class="titulo">Resumen del Turno</h2>

            <!-- Layout especial para rol punto_pos -->
            <div *ngIf="isPuntoPos; else layoutTurnoNormal" class="turno-resumen-grid">
              <div class="col-izquierda">
                <div class="bloque">
                    <h4>Turno</h4>
                    <p><strong>Inicio:</strong> {{resumen.turno.inicioTurno | date:'short'}}</p>
                    <p><strong>Fin:</strong> {{resumen.turno.finTurno | date:'short'}}</p>
                    <p><strong>Observaciones:</strong> {{resumen.turno.observaciones || 'Sin comentarios'}}</p>
                </div>

                <div class="bloque">
                    <h4>Caja</h4>
                    <ng-container *ngIf="resumen.aperturaCaja">
                        <p><strong>Apertura:</strong> {{resumen.aperturaCaja.fecha | date:'shortTime'}} </p>
                        <p><strong>Monto Inicial:</strong> ${{ saldoInicial | number:'1.0-0'}} </p>
                        <p><strong>Total Ventas:</strong> ${{ totalVentas | number:'1.0-0' }} </p>
                        <p><strong>Monto Esperado:</strong>
                          ${{ saldoEsperado | number:'1.0-0' }}
                        </p>
                    </ng-container>
                    <ng-container *ngIf="resumen.cierreCaja; else sinCierrePuntoPos">
                        <p><strong>Cierre:</strong> {{resumen.cierreCaja.fecha | date:'shortTime'}}</p>
                        <p><strong>Monto Final (real):</strong> ${{ saldoFinal | number:'1.0-0'}} </p>
                        <p *ngIf="resumen.aperturaCaja" [ngClass]="diferenciaClase()">
                          <strong>Diferencia:</strong>
                          ${{ diferencia | number:'1.0-0' }}
                        </p>
                    </ng-container>
                    <ng-template #sinCierrePuntoPos>
                        <p><em>Aún sin cierre de caja.</em></p>
                    </ng-template>
                </div>

                

                <div class="bloque" *ngIf="!resumen.cierreCaja && !isAdmin">
                    <button type="button" class="btn-turno" (click)="cerrarTurno()">Terminar turno</button>
                </div>
              </div>

              
            </div>

            <!-- Layout original para otros roles -->
            <ng-template #layoutTurnoNormal>
              <div class="bloque">
                  <h4>Turno</h4>
                  <p><strong>Inicio:</strong> {{resumen.turno.inicioTurno | date:'short'}}</p>
                  <p><strong>Fin:</strong> {{resumen.turno.finTurno | date:'short'}}</p>
                  <p><strong>Observaciones:</strong> {{resumen.turno.observaciones || 'Sin comentarios'}}</p>
              </div>

              <div class="bloque">
                <h4>Caja</h4>
                <ng-container *ngIf="resumen.aperturaCaja">
                    <p><strong>Apertura:</strong> {{resumen.aperturaCaja.fecha | date:'shortTime'}} </p>
                    <p><strong>Monto Inicial:</strong> ${{ saldoInicial | number:'1.0-0'}} </p>
                    <p><strong>Total Ventas:</strong> ${{ totalVentas | number:'1.0-0' }} </p>
                    <p><strong>Monto Esperado:</strong>
                      ${{ saldoEsperado | number:'1.0-0' }}
                    </p>
                </ng-container>
                <ng-container *ngIf="resumen.cierreCaja; else sinCierre">
                    <p><strong>Cierre:</strong> {{resumen.cierreCaja.fecha | date:'shortTime'}}</p>
                    <p><strong>Monto Final (real):</strong> ${{ saldoFinal | number:'1.0-0'}} </p>
                    <p *ngIf="resumen.aperturaCaja" [ngClass]="diferenciaClase()">
                      <strong>Diferencia:</strong>
                      ${{ diferencia | number:'1.0-0' }}
                    </p>
                </ng-container>
                <ng-template #sinCierre>
                    <p><em>Aún sin cierre de caja.</em></p>
                </ng-template>
              </div>

              <div class="bloque" *ngIf="!resumen.cierreCaja && !isAdmin">
                  <button type="button" class="btn-turno" (click)="cerrarTurno()">Terminar turno</button>
              </div>
            </ng-template>
        </div>

        <!-- Vista ADMIN: solo contenido; las opciones se eligen desde la navbar -->
        <div *ngIf="isAdmin" class="admin-layout">
            <div class="admin-contenido">
                <app-turnos-dia *ngIf="showTurnosDia"></app-turnos-dia>
                <router-outlet *ngIf="!showTurnosDia"></router-outlet>
            </div>
        </div>

    </section>
  </main>
</div>