<section>
  <div class="container-fluid turnos-cerrados-container">
    <div class="row">
      <div class="col-12">
        <div class="turno-card">
          <h2 class="titulo">
            <i class="bi bi-people me-2"></i>
            <span>Turnos cerrados</span>
          </h2>
          <div class="filtros-con-labels">
            <div class="campo-buscar">
              <label for="buscar-input" class="campo-label">Buscador</label>
              <div class="input-icon">
                <i class="bi bi-search" aria-hidden="true"></i>
                <input id="buscar-input" type="search" [(ngModel)]="q" placeholder="Buscar por nombre/correo" class="form-control" aria-label="Buscar">
              </div>
            </div>
            <div class="campo-fecha">
              <label for="fecha-desde" class="campo-label">Desde</label>
              <input id="fecha-desde" type="date" [(ngModel)]="from" class="form-control clickable-date" aria-label="Desde" title="Desde (fecha)" (click)="openDatePicker($event)" readonly>
            </div>
            <div class="campo-fecha">
              <label for="fecha-hasta" class="campo-label">Hasta</label>
              <input id="fecha-hasta" type="date" [(ngModel)]="to" class="form-control clickable-date" aria-label="Hasta" title="Hasta (fecha)" (click)="openDatePicker($event)" readonly>
            </div>
          </div>
          <div *ngIf="cargando">Cargando...</div>
          <div *ngIf="!cargando && view.length === 0">
            <p>No hay Turnos Cerrados.</p>
          </div>
          <ul class="turno-lista" *ngIf="!cargando && view.length > 0">
            <li class="turno-item" *ngFor="let item of view" (click)="abrirDetalle(item)" role="button" tabindex="0">
              <i class="bi bi-person-fill item-icon" aria-hidden="true"></i>
              <div class="turno-item-info">
                <div class="turno-item-primario"><strong>{{ (item?.fullName || item?.nombreCompleto) || ((((item?.nombres || item?.nombre || '') + ' ' + (item?.apellidos || item?.apellido || '')).trim())) || item?.correo || ('Usuario ' + (item?.usuarioId || '')) }}</strong></div>
                <div class="turno-item-secundario">
                  <i class="bi bi-clock inline" aria-hidden="true"></i>
                  <span>{{item.resumen.turno.inicioTurno | date:'short'}}</span>
                  <span *ngIf="item.resumen.turno.finTurno">
                    · <i class="bi bi-clock-history inline" aria-hidden="true"></i>
                    {{item.resumen.turno.finTurno | date:'short'}}
                  </span>
                </div>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</section>

<div class="modal-backdrop" [hidden]="!modalAbierto"></div>
<div class="modal-contenedor" [hidden]="!modalAbierto" role="dialog" aria-modal="true">
  <div class="modal-header">
    <h3 class="modal-title">
      <i class="bi bi-person-workspace me-2"></i>
      <span>Detalle del turno</span>
    </h3>
    <button type="button" class="modal-cerrar" (click)="cerrarDetalle($event)">✕</button>
  </div>
  <div class="modal-body" *ngIf="seleccionado as s">
    <div class="datos-grid">
      <div class="kv"><span class="k">Empleado</span><span class="v">{{ (s?.nombre || '') + ' ' + (s?.apellido || '') }}</span></div>
      <div class="kv"><span class="k">Inicio</span><span class="v">{{ s?.resumen?.turno?.inicioTurno | date:'short' }}</span></div>
      <div class="kv"><span class="k">Fin</span><span class="v">{{ s?.resumen?.turno?.finTurno | date:'short' }}</span></div>
      <div class="kv kv-span"><span class="k">Observaciones</span><span class="v">{{ s?.resumen?.turno?.observaciones || 'Sin comentarios' }}</span></div>
    </div>

    <div class="resumen-compacto">
      <div><strong>Duración:</strong> {{ duracionTurno(s) }}</div>
    </div>
  </div>
  <div class="modal-footer" (click)="$event.stopPropagation()">
    <button type="button" class="btn-sec" (click)="cerrarDetalle($event)">Cerrar</button>
    <button type="button" class="btn-turno" (click)="verMasDetalle($event)">Ver más</button>
  </div>
</div>
<app-agente-ia></app-agente-ia>