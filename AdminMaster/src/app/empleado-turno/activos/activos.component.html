<div class="turno-card">
  <h2 class="titulo">Turnos activos</h2>
  <div class="filtros" style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px;align-items:center;">
    <div class="input-icon" style="flex:1 1 220px;min-width:200px;">
      <i class="bi bi-search" aria-hidden="true"></i>
      <input type="search" [(ngModel)]="q" placeholder="Buscar por nombre/correo" class="form-control" aria-label="Buscar">
    </div>
    <input type="date" [(ngModel)]="from" class="form-control" aria-label="Desde" placeholder="Desde (fecha)" title="Desde (fecha)">
    <input type="date" [(ngModel)]="to" class="form-control" aria-label="Hasta" placeholder="Hasta (fecha)" title="Hasta (fecha)">
  </div>
  <div *ngIf="cargando">Cargando...</div>
  <div *ngIf="!cargando && view.length === 0">
    <p>No hay turnos activos.</p>
  </div>
  <ul class="turno-lista" *ngIf="!cargando && view.length > 0">
    <li class="turno-item" *ngFor="let item of view" (click)="abrirDetalle(item)" role="button" tabindex="0">
      <i class="bi bi-person-fill item-icon" aria-hidden="true"></i>
      <div class="turno-item-info">
        <div class="turno-item-primario">
          <strong>{{ (item?.fullName || item?.nombreCompleto) || ((((item?.nombres || item?.nombre || '') + ' ' + (item?.apellidos || item?.apellido || '')).trim())) || item?.correo || ('Usuario ' + (item?.usuarioId || '')) }}</strong>
        </div>
        <div class="turno-item-secundario text-muted">
          <i class="bi bi-clock inline" aria-hidden="true"></i>
          Inicio: {{item.resumen.turno.inicioTurno | date:'short'}}
        </div>
        <div class="turno-item-secundario text-muted" *ngIf="item.resumen.turno.finTurno">
          <i class="bi bi-clock-history inline" aria-hidden="true"></i>
          Fin: {{item.resumen.turno.finTurno | date:'short'}}
        </div>
      </div>
    </li>
  </ul>
</div>

<div class="modal-backdrop" [hidden]="!modalAbierto"></div>
<div class="modal-contenedor" [hidden]="!modalAbierto" role="dialog" aria-modal="true" (click)="$event.stopPropagation()">
  <div class="modal-header">
    <h3>Detalle del turno activo</h3>
    <button type="button" class="modal-cerrar" (click)="cerrarDetalle($event)">âœ•</button>
  </div>
  <div class="modal-body" *ngIf="seleccionado as s" (click)="$event.stopPropagation()">
    <div class="datos-grid">
      <div class="kv"><span class="k">Empleado</span><span class="v">{{ (s.nombre || '') + ' ' + (s.apellido || '') }}</span></div>
      <div class="kv"><span class="k">Inicio</span><span class="v">{{ s.resumen.turno.inicioTurno | date:'short' }}</span></div>
      <div class="kv"><span class="k">Fin</span><span class="v">{{ s.resumen.turno.finTurno | date:'short' }}</span></div>
      <div class="kv kv-span"><span class="k">Observaciones</span><span class="v">{{ s.resumen.turno.observaciones || 'Sin comentarios' }}</span></div>
    </div>
  </div>
  <div class="modal-footer" (click)="$event.stopPropagation()">
    <button type="button" class="btn-turno" (click)="cerrarDetalle($event)">Cerrar</button>
  </div>
</div>
