<section>
  <div class="container-fluid notificaciones-container">
    <div class="row">
      <div class="col-12">
        <div class="turno-card">
          <h2 class="titulo text-center text-md-start">
            <i class="bi bi-calendar-check me-2"></i>
            <span>Registro de Turnos</span>
          </h2>

  <div class="form-grid">
    <div class="campo text-center text-md-start" (click)="fechaInput.showPicker()">
      <label>Fecha</label>
      <input #fechaInput type="date" class="form-control w-100" [(ngModel)]="fechaSeleccionada" [attr.min]="minFecha" (change)="onFechaChange()">
    </div>

    <div class="campo text-center text-md-start">
      <label>Jornada</label>
      <select class="form-select w-100" [(ngModel)]="bloque" (ngModelChange)="onJornadaChange($event)">
        <option value="manana">Mañana</option>
        <option value="tarde">Tarde</option>
        <option value="noche">Noche</option>
      </select>
    </div>

    <div class="campo campo-hora-desde text-center text-md-start" (click)="horaDesdeInput.showPicker()">
      <label>Hora desde</label>
      <input #horaDesdeInput type="time" class="form-control w-100" [(ngModel)]="horaDesde">
    </div>

    <div class="campo campo-hora-hasta text-center text-md-start" (click)="horaHastaInput.showPicker()">
      <label>Hora hasta</label>
      <input #horaHastaInput type="time" class="form-control w-100" [(ngModel)]="horaHasta">
    </div>

    <div class="campo campo-notas text-center text-md-start">
      <label>Notas (opcional)</label>
      <textarea class="form-control w-100" rows="1" [(ngModel)]="notas" placeholder="Ej: Reforzar caja, inventario, etc."></textarea>
    </div>

    <div class="campo campo-boton text-center text-md-start px-2">
      <button type="button" class="btn btn-primary w-100" style="max-width: 100%; box-sizing: border-box;" (click)="agregarTurno()">
        Agregar Turno
      </button>
    </div>
  </div>

  <div class="campo mt-3 filtro-fecha-turnos text-center text-md-start" (click)="fechaConsultaInput.showPicker()">
    <label>Ver registros de</label>
    <input #fechaConsultaInput type="date" class="form-control w-100" [(ngModel)]="fechaConsulta" (change)="onFechaConsultaChange()">
  </div>

  <div class="lista" *ngIf="turnosDeFechaActual().length; else sinTurnosTpl">
    <h6 class="mt-3">Turnos registrados para {{ fechaConsulta || fechaSeleccionada }}</h6>

    <ul class="list-group">
      <li class="list-group-item d-flex justify-content-between align-items-center"
          *ngFor="let t of turnosDeFechaActual()">
        <div>
          <strong>
            {{ t.bloque === 'manana' ? 'Mañana' : (t.bloque === 'tarde' ? 'Tarde' : 'Noche') }}
          </strong>
          <span *ngIf="getEstadoCalculado(t) as est" class="ms-2 badge"
                [ngClass]="{
                  'bg-primary': est === 'por_cumplir',
                  'bg-warning text-dark': est === 'pendiente',
                  'bg-success': est === 'cumplido',
                  'bg-danger': est === 'incumplido'
                }">
            {{ est === 'por_cumplir' ? 'Por cumplir'
              : (est === 'pendiente' ? 'Pendiente'
              : (est === 'cumplido' ? 'Cumplido' : 'Incumplido')) }}
          </span>
          <span *ngIf="t.horaDesde || t.horaHasta">
            &nbsp;|&nbsp;
            <ng-container *ngIf="t.horaDesde">{{ t.horaDesde }}</ng-container>
            <ng-container *ngIf="t.horaDesde && t.horaHasta"> - </ng-container>
            <ng-container *ngIf="t.horaHasta">{{ t.horaHasta }}</ng-container>
          </span>
          <span *ngIf="t.notas"> - {{ t.notas }}</span>
          <span *ngIf="getObservacionCalculada(t) as obs" class="d-block small text-muted mt-1">
            {{ obs }}
          </span>
        </div>
        <button *ngIf="getEstadoCalculado(t) === 'por_cumplir'"
                type="button"
                class="btn btn-sm btn-eliminar-turno"
                (click)="eliminarTurno(t.id)">
          <i class="bi bi-trash me-1"></i>
          <span>Eliminar</span>
        </button>
      </li>
    </ul>
  </div>

  <ng-template #sinTurnosTpl>
    <p class="texto-vacio mt-3">No hay Turnos Registrados para esta Fecha.</p>
  </ng-template>
        </div>
      </div>
    </div>
  </div>
</section>
<app-agente-ia></app-agente-ia>