<section>
  <div class="container-fluid notificaciones-container">
    <div class="row">
      <div class="col-12">
        <div class="turno-card">
          <h2 class="titulo text-center text-md-start">
            <i class="bi bi-calendar-check me-2"></i>
            <span>Registro de Turnos</span>
          </h2>

  <div class="form-grid">
    <div class="campo text-center text-md-start">
      <label>Fecha</label>
      <div class="date-input-container w-100">
        <div class="date-input-wrapper" (click)="fechaInput.showPicker()">
          <svg class="date-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
          <input
            #fechaInput
            type="date"
            class="modern-date-input"
            [(ngModel)]="fechaSeleccionada"
            [attr.min]="minFecha"
            (change)="onFechaChange()">
        </div>
      </div>
    </div>

    <div class="campo text-center text-md-start">
      <label>Jornada</label>
      <div class="dropdown w-100">
        <button
          class="modern-range-btn jornada-btn w-100 d-flex align-items-center justify-content-between"
          type="button"
          data-bs-toggle="dropdown"
          data-bs-auto-close="true">
          <div class="d-flex align-items-center w-100">
            <i
              class="me-2"
              [ngClass]="{
                'bi bi-sunrise-fill': bloque === 'manana',
                'bi bi-sun-fill': bloque === 'tarde',
                'bi bi-moon-stars-fill': bloque === 'noche'
              }"></i>
            <span class="range-text">
              {{
                bloque === 'manana'
                  ? 'Mañana'
                  : (bloque === 'tarde' ? 'Tarde' : 'Noche')
              }}
            </span>
          </div>
          <div class="range-arrow">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </div>
        </button>
        <div class="dropdown-menu modern-range-dropdown">
          <a
            class="dropdown-item modern-range-item"
            [class.active]="bloque === 'manana'"
            href="#"
            (click)="bloque = 'manana'; onJornadaChange('manana'); $event.preventDefault()">
            <i class="bi bi-sunrise-fill me-2"></i>
            <span class="range-item-text">Mañana</span>
          </a>
          <a
            class="dropdown-item modern-range-item"
            [class.active]="bloque === 'tarde'"
            href="#"
            (click)="bloque = 'tarde'; onJornadaChange('tarde'); $event.preventDefault()">
            <i class="bi bi-sun-fill me-2"></i>
            <span class="range-item-text">Tarde</span>
          </a>
          <a
            class="dropdown-item modern-range-item"
            [class.active]="bloque === 'noche'"
            href="#"
            (click)="bloque = 'noche'; onJornadaChange('noche'); $event.preventDefault()">
            <i class="bi bi-moon-stars-fill me-2"></i>
            <span class="range-item-text">Noche</span>
          </a>
        </div>
      </div>
    </div>

    <div class="campo campo-hora-desde text-center text-md-start">
      <label>Hora desde</label>
      <div class="date-input-container w-100">
        <div class="date-input-wrapper" (click)="horaDesdeInput.showPicker()">
          <svg class="date-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
          <input
            #horaDesdeInput
            type="time"
            class="modern-date-input"
            [(ngModel)]="horaDesde">
        </div>
      </div>
    </div>

    <div class="campo campo-hora-hasta text-center text-md-start">
      <label>Hora hasta</label>
      <div class="date-input-container w-100">
        <div class="date-input-wrapper" (click)="horaHastaInput.showPicker()">
          <svg class="date-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
          <input
            #horaHastaInput
            type="time"
            class="modern-date-input"
            [(ngModel)]="horaHasta">
        </div>
      </div>
    </div>

    <div class="campo campo-notas text-center text-md-start">
      <label>Notas (opcional)</label>
      <textarea class="form-control w-100" rows="1" [(ngModel)]="notas" placeholder="Ej: Reforzar caja, inventario, etc."></textarea>
    </div>

    <div class="campo campo-boton text-center text-md-start px-2">
      <button type="button" class="btn btn-primary w-100" style="max-width: 100%; box-sizing: border-box;" (click)="agregarTurno()">
        Agregar Turno
      </button>
    </div>
  </div>

  <div class="campo mt-3 filtro-fecha-turnos text-center text-md-start">
    <label>Ver registros de</label>
    <div class="date-input-container w-100">
      <div class="date-input-wrapper" (click)="fechaConsultaInput.showPicker()">
        <svg class="date-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        <input
          #fechaConsultaInput
          type="date"
          class="modern-date-input"
          [(ngModel)]="fechaConsulta"
          (change)="onFechaConsultaChange()">
      </div>
    </div>
  </div>

  <div class="lista" *ngIf="turnosDeFechaActual().length; else sinTurnosTpl">
    <h6 class="mt-3">Turnos registrados para {{ fechaConsulta || fechaSeleccionada }}</h6>

    <ul class="list-group">
      <li class="list-group-item d-flex justify-content-between align-items-center"
          *ngFor="let t of turnosDeFechaActual()">
        <div>
          <strong>
            {{ t.bloque === 'manana' ? 'Mañana' : (t.bloque === 'tarde' ? 'Tarde' : 'Noche') }}
          </strong>
          <span *ngIf="getEstadoCalculado(t) as est" class="ms-2 badge"
                [ngClass]="{
                  'bg-primary': est === 'por_cumplir',
                  'bg-warning text-dark': est === 'pendiente',
                  'bg-success': est === 'cumplido',
                  'bg-danger': est === 'incumplido'
                }">
            {{ est === 'por_cumplir' ? 'Por cumplir'
              : (est === 'pendiente' ? 'Pendiente'
              : (est === 'cumplido' ? 'Cumplido' : 'Incumplido')) }}
          </span>
          <span *ngIf="t.horaDesde || t.horaHasta">
            &nbsp;|&nbsp;
            <ng-container *ngIf="t.horaDesde">{{ t.horaDesde }}</ng-container>
            <ng-container *ngIf="t.horaDesde && t.horaHasta"> - </ng-container>
            <ng-container *ngIf="t.horaHasta">{{ t.horaHasta }}</ng-container>
          </span>
          <span *ngIf="t.notas"> - {{ t.notas }}</span>
          <span *ngIf="getObservacionCalculada(t) as obs" class="d-block small text-muted mt-1">
            {{ obs }}
          </span>
        </div>
        <button *ngIf="getEstadoCalculado(t) === 'por_cumplir'"
                type="button"
                class="btn btn-sm btn-eliminar-turno"
                (click)="eliminarTurno(t.id)">
          <i class="bi bi-trash me-1"></i>
          <span>Eliminar</span>
        </button>
      </li>
    </ul>
  </div>

  <ng-template #sinTurnosTpl>
    <p class="texto-vacio mt-3">No hay Turnos Registrados para esta Fecha.</p>
  </ng-template>
        </div>
      </div>
    </div>
  </div>
</section>
<app-agente-ia></app-agente-ia>