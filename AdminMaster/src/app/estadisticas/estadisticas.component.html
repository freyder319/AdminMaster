<div class="with-sidebar">
  <header>
    <app-admin-navbar></app-admin-navbar>
  </header>

  <main>
  <div class="stats-container">
    <br>
    <h1 class="text-center mb-4 titulo_estadisticas">
      <i class="bi bi-bar-chart-line-fill me-2"></i>
      <span>Estadísticas</span>
    </h1>

    <!-- Selector de opciones -->
    <div class="options-grid">
      <div class="option-card" [class.active]="selectedOption === 'inventario'" (click)="selectOption('inventario')">
        <img src="/assets/img/icon_estadisticas/gestion-de-materiales.png" class="custom-icon">
        <h3>Rendimiento del Inventario</h3>
        <div class="indicator"></div>
      </div>

      <div class="option-card" [class.active]="selectedOption === 'comercial'" (click)="selectOption('comercial')">
        <img src="/assets/img/icon_estadisticas/sitio-web.png" class="custom-icon">
        <h3>Desempeño Comercial</h3>
        <div class="indicator"></div>
      </div>

      <div class="option-card" [class.active]="selectedOption === 'finanzas'" (click)="selectOption('finanzas')">
        <img src="/assets/img/icon_estadisticas/presupuesto (1).png" class="custom-icon">
        <h3>Salud Financiera</h3>
        <div class="indicator"></div>
      </div>
    </div>

    <!-- Filtro de período -->
    <div class="d-flex justify-content-center mb-4 gap-2 filtro-periodo">
      <button
        type="button"
        class="btn btn-periodo"
        [ngClass]="{'btn-periodo-activo': periodoSeleccionado === 'semanal'}"
        (click)="cambiarPeriodo('semanal')">
        <i class="bi bi-calendar-week me-1"></i>
        <span>Semanal</span>
      </button>
      <button
        type="button"
        class="btn btn-periodo"
        [ngClass]="{'btn-periodo-activo': periodoSeleccionado === 'mensual'}"
        (click)="cambiarPeriodo('mensual')">
        <i class="bi bi-calendar-month me-1"></i>
        <span>Mensual</span>
      </button>
    </div>

    <!-- Detalle de filtro: mes y semana -->
    <div class="d-flex justify-content-center mb-4 gap-2 filtro-periodo">
      <select class="form-select form-select-sm w-auto select-periodo" (change)="onMesChange($any($event.target).value)">
        <option value="">Mes (todos)</option>
        <option value="1">Enero</option>
        <option value="2">Febrero</option>
        <option value="3">Marzo</option>
        <option value="4">Abril</option>
        <option value="5">Mayo</option>
        <option value="6">Junio</option>
        <option value="7">Julio</option>
        <option value="8">Agosto</option>
        <option value="9">Septiembre</option>
        <option value="10">Octubre</option>
        <option value="11">Noviembre</option>
        <option value="12">Diciembre</option>
      </select>

      <select
        *ngIf="periodoSeleccionado === 'semanal'"
        class="form-select form-select-sm w-auto select-periodo select-periodo-semana"
        (change)="onSemanaChange($any($event.target).value)">
        <option value="">Semana (todas)</option>
        <option value="1">Semana 1</option>
        <option value="2">Semana 2</option>
        <option value="3">Semana 3</option>
        <option value="4">Semana 4</option>
        <option value="5">Semana 5</option>
      </select>

    </div>

    <!-- CONTENIDO CAMBIANTE -->
    <div class="content-container" [@fadeInOut]>

      <!-- INVENTARIO -->
      <div *ngIf="selectedOption === 'inventario'" class="content-pane">
        <h2 class="section-title">
          <i class="bi bi-box-seam-fill section-title-icon"></i>
          <span>Rendimiento del Inventario</span>
        </h2>

        <div *ngIf="hayDatosInventario; else sinDatosInventario" class="chart-grid">

          <div class="chart-container">
            <h3>Distribución del inventario por categoría</h3>
            <canvas baseChart [data]="pieChartCategorias" [options]="pieChartOptions" [type]="pieChartType"></canvas>
          </div>

          <div class="chart-container">
            <h3>Productos con mayor precio comercial</h3>
            <canvas baseChart [data]="barChartDataPrecios" [options]="barChartOptions" [type]="barChartType"></canvas>
          </div>

          <div class="chart-container">
            <h3>Top 5 productos por valor económico del inventario</h3>
            <canvas baseChart [type]="barChartType" [data]="barChartValor" [options]="barChartValorOptions"></canvas>
          </div>

          <div class="chart-container">
            <h3>Productos con menor rotación</h3>
            <canvas baseChart [data]="barChartRotacion" [type]="'bar'" [options]="{ responsive: true }"></canvas>
          </div>

          <div class="chart-container" *ngIf="hasStockCritico">
            <h3>Productos con stock crítico</h3>
            <canvas baseChart [data]="barChartStockCritico" [options]="barChartStockCriticoOptions" [type]="'bar'"></canvas>
          </div>

          <p *ngIf="!hasStockCritico">No hay productos con stock crítico.</p>

          <div class="chart-container">
            <h3>Promedio de rotación (Stock / Ventas)</h3>
            <canvas baseChart [data]="bubbleChartRotacion" [type]="'bubble'" [options]="bubbleChartRotacionOptions"></canvas>
          </div>

        </div>
        <ng-template #sinDatosInventario>
          <p class="text-center mt-3">No hay Datos para este Período.</p>
        </ng-template>
      </div>

      <!-- COMERCIAL -->
      <div *ngIf="selectedOption === 'comercial'" class="content-pane">
        <h2 class="section-title">
          <i class="bi bi-graph-up-arrow section-title-icon"></i>
          <span>Desempeño Comercial</span>
        </h2>

        <div *ngIf="hayDatosComercial; else sinDatosComercial" class="chart-grid">
          <div class="chart-container">
            <h3>Productos más vendidos</h3>
            <canvas baseChart [data]="barChartData" [options]="barChartOptions" [type]="barChartType"></canvas>
          </div>

          <div class="chart-container">
            <h3>Gráfico de ventas</h3>
            <canvas baseChart [data]="lineChartVentas" [options]="lineChartVentasOptions" [type]="'line'"></canvas>
          </div>
          <div class="chart-container">
            <h3>Ventas por método de pago</h3>
            <canvas baseChart [data]="pieChartMetodosPago" [type]="'pie'"></canvas>
          </div>

          <div class="chart-container">
            <h3>Ventas por categoría</h3>
            <canvas baseChart [data]="pieChartCategoriasVenta" [type]="'pie'"></canvas>
          </div>

          <div class="chart-container">
            <h3>Cantidad de ventas por mes</h3>
            <canvas baseChart [data]="barChartVentasMes" [type]="'bar'"></canvas>
          </div>

          <div class="chart-container">
            <h3>Productos más rentables</h3>
            <canvas baseChart [data]="barChartProductosRentables" [type]="'bar'" [options]="{ indexAxis: 'y' }"></canvas>
          </div>
        </div>
        <ng-template #sinDatosComercial>
          <p class="text-center mt-3">No hay Datos para este Período.</p>
        </ng-template>
      </div>

      <!--  FINANZAS -->
      <div *ngIf="selectedOption === 'finanzas'" class="content-pane">
        <h2 class="section-title">
          <i class="bi bi-cash-coin section-title-icon"></i>
          <span>Salud Financiera</span>
        </h2>
        <div *ngIf="hayDatosFinanzas; else sinDatosFinanzas" class="chart-grid">

    <!-- 1. Ingresos vs Gastos mensual -->
    <div class="chart-container">
      <h3>Ingresos vs Gastos (Mensual)</h3>
      <canvas baseChart
        [data]="lineIngresosGastos"
        [type]="'line'"
        [options]="{ responsive: true }">
      </canvas>
    </div>

    <!-- 2. Margen de beneficio -->
    <div class="chart-container">
      <h3>Margen de Beneficio (%)</h3>
      <canvas baseChart
        [data]="barMargenBeneficio"
        [type]="'bar'"
        [options]="{ responsive: true }">
      </canvas>
    </div>

    <!-- 3. Evolución de ganancias mensuales -->
    <div class="chart-container">
      <h3>Evolución de ganancias mensuales</h3>
      <canvas baseChart
        [data]="lineGananciasMensuales"
        [type]="'line'"
        [options]="{ responsive: true }">
      </canvas>
    </div>

    <!-- 4. Distribución de gastos -->
    <div class="chart-container">
      <h3>Distribución de gastos</h3>
      <canvas baseChart
        [data]="pieGastos"
        [type]="'pie'">
      </canvas>
    </div>

    <!-- 5. Ticket promedio de venta -->
    <div class="chart-container">
      <h3>Ticket promedio de venta</h3>
      <canvas baseChart
        [data]="barTicketPromedio"
        [type]="'bar'"
        [options]="{ responsive: true }">
      </canvas>
    </div>

    <!-- 6. Productos más rentables (finanzas) -->
    <div class="chart-container">
      <h3>Productos con mayor ganancia total</h3>
      <canvas baseChart
        [data]="barProductosGanancia"
        [type]="'bar'"
        [options]="{ indexAxis: 'y' }">
      </canvas>
    </div>
        </div>
        <ng-template #sinDatosFinanzas>
          <p class="text-center mt-3">No hay Datos para este Período.</p>
        </ng-template>
      </div>

    </div> 
  </div>
  </main>
</div>
