<header>
    <app-admin-navbar></app-admin-navbar>
</header>

<main>
    <!-- Vista normal (solo cuando NO estoy en agregar NI modificar) -->
    <div *ngIf="!mostrarAddEmpleado && !mostrarModificarEmpleado">

        <!-- Titulo -->
        <section>
            <div class="container text-center">
                <div class="row">
                    <div class="col">
                        <h1 class="tit-empleados">Empleados</h1>
                    </div>
                </div>
            </div>
        </section>

        <br>

        <!-- Busqueda y Agregar -->
        <section>
            <div class="container buscar-agg">
                <div class="row">
                    <!-- Buscar -->
                    <div class="col-sm-12 col-md-6 col-lg-6">
                        <div class="search">
                            <div class="input-group">
                                <input type="text" class="form-control" placeholder="Buscar Empleado..." id="search-input" (input)="onSearch($any($event.target).value)">
                            </div>
                        </div>
                    </div>

                    <!-- Agregar Empleado -->
                    <div class="col-sm-12 col-md-6 col-lg-6">
                        <div class="agg-cli">

                            <!-- Para pantallas grandes (≥768px) → abre offcanvas -->
                            <button class="btn agregar d-none d-md-inline-block" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasAddEmpleado" aria-controls="offcanvasAddEmpleado">
                                <span class="texto">Agregar Empleado</span>
                                <img width="80px" src="../../assets/img/icons_empleado/agregarEmpleado.png" alt="">
                            </button>

                            <!-- Para pantallas pequeñas (<768px) → cambia de interfaz -->
                            <button class="btn agregar d-md-none" type="button" (click)="mostrarAddEmpleado = true">
                                <span class="texto">Agregar Empleado</span>
                                <img width="80px" src="../../assets/img/icons_empleado/agregarEmpleado.png" alt="">
                            </button>

                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tablas Informacion -->
        <section>
            <div class="container">
                <table class="table table-bordered">
                    <thead class="table-secondary">
                        <tr>
                        <th>Correo</th>
                        <th>Teléfono</th>
                        <th>Caja Asignada</th>
                        <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody *ngIf="(filteredEmpleados$ | async) as list">
                        <tr *ngFor="let empleado of list">
                            <td data-label="Correo">
                                <!-- Móvil -->
                                <div class="perfil clickable d-md-none" (click)="mostrarInterfazReponsive(empleado.id)">
                                    <img src="../../assets/img/icons-navbar/Empleados.png" alt="Empleado">
                                    <div class="info">
                                        <p class="correo">{{empleado.correo}}</p>
                                        <p class="caja">{{empleado.caja?.nombre || 'Sin asignar'}}</p>
                                    </div>
                                </div>

                                <!-- Escritorio -->
                                <div class="perfil d-none d-md-flex">
                                    <img src="../../assets/img/icons-navbar/Empleados.png" alt="Empleado" width="50px" height="50px">
                                    <div class="info">
                                        <p class="correo">{{empleado.correo}}</p>
                                    </div>
                                </div>
                            </td>

                            <!-- Teléfono (solo visible en escritorio) -->
                            <td data-label="Teléfono" class="d-none d-md-table-cell">{{empleado.telefono}}</td>

                            <!-- Caja (solo visible en escritorio) -->
                            <td data-label="Caja" class="d-none d-md-table-cell">
                                <span *ngIf="empleado.caja">{{empleado.caja.nombre}}</span>
                                <span *ngIf="!empleado.caja">Sin asignar</span>
                            </td>

                            <!-- Acciones -->
                            <td data-label="Acciones" class="acciones">
                                <!-- Botones con texto (≥1200px) -->
                                <div class="d-none d-xl-flex gap-2">
                                    <button (click)="guardarId(empleado.id)" class="btn modificar d-none d-md-inline-block" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasModifyEmpleado" aria-controls="offcanvasModifyEmpleado">
                                        <span class="texto">Modificar</span>
                                    </button>
                                    <button (click)="eliminarEmpleado(empleado.id)" class="btn elimi">Eliminar</button>
                                </div>

                                <!-- Botones con íconos (768px – 1200px) -->
                                <div class="d-none d-md-flex d-xl-none gap-2">
                                    <button class="btn modificar icon-btn d-none d-md-inline-block" title="Modificar" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasModifyEmpleado" aria-controls="offcanvasModifyEmpleado">
                                        <i class="bi bi-pencil-square"></i>
                                    </button>
                                    <button (click)="eliminarEmpleado(empleado.id)" class="btn eliminar-icon icon-btn" title="Eliminar">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>

                        <!-- Sin resultados / Sin empleados -->
                        <tr *ngIf="list.length === 0">
                            <td colspan="4" class="text-center">
                                {{ lastSearchTerm ? ('No se encontró ningún empleado para "' + lastSearchTerm + '".') : 'No hay Empleados registrados' }}
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </div>
    
    <!-- Vista de Agregar Empleado en móvil (<768px) -->
    <div *ngIf="mostrarAddEmpleado" class="d-md-none">
        <div class="container mt-4 p-3 shadow rounded bg-light">
            <app-add-empleados (empleadoAgregado)="onEmpleadoAgregado()"></app-add-empleados>
            <div class="mt-3">
                <button class="btn btn-volver" type="button" aria-label="Volver" (click)="mostrarAddEmpleado = false">
                    <i class="bi bi-arrow-left-short"></i> Volver
                </button>
            </div>
        </div>
    </div>

    <!-- Vista de Modificar Empleado en móvil (<768px) -->
    <div *ngIf="mostrarModificarEmpleado" class="d-md-none">
        <div class="container mt-4 p-3 shadow rounded bg-light">
        <app-modify-empleado *ngIf="empleadoSeleccionado" [empleadoId]="empleadoSeleccionado.id"></app-modify-empleado>
            <div class="mt-3 space">
                <button class="btn btn-volver" type="button" (click)="mostrarModificarEmpleado = false; empleadoSeleccionado = null">
                    <i class="bi bi-arrow-left-short"></i> Volver
                </button>
                <!-- MODIFICAR LO DE ELIMINAR -->
                <button *ngIf="empleadoSeleccionado" (click)="eliminarEmpleado(empleadoSeleccionado.id)" class="btn eliminar">
                    <i class="bi bi-trash-fill"></i>Eliminar
                </button>
            </div>
        </div>
    </div>

</main>

<!-- Offcanvas (solo para pantallas grandes) Agregar -->
<div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasAddEmpleado" aria-labelledby="offcanvasAddEmpleadoLabel">
    <div class="offcanvas-header">
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Cerrar"></button>
    </div>
    <div class="offcanvas-body">
        <app-add-empleados (empleadoAgregado)="onEmpleadoAgregado()"></app-add-empleados>
    </div>
</div>

<!-- Offcanvas (solo para pantallas grandes) Modificar -->
<div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasModifyEmpleado" aria-labelledby="offcanvasModifyEmpleadoLabel" (hidden.bs.offcanvas)="empleadoSeleccionado = null">
    <div class="offcanvas-header">
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Cerrar"></button>
    </div>
    <div class="offcanvas-body">
        <app-modify-empleado *ngIf="empleadoSeleccionado" [empleadoId]="empleadoSeleccionado.id" (empleadoModificado)="onEmpleadoModificado()"></app-modify-empleado>
    </div>
</div>