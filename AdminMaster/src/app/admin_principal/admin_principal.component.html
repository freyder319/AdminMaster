<div class="with-sidebar">
  <header>
    <app-admin-navbar></app-admin-navbar>
  </header>

  <div class="main">
  <!-- Título -->
  <section>
    <div class="container">
      <div class="row">
        <div class="col">
          <h1 class="tit-movimientos">
            <i class="bi bi-arrow-left-right me-2"></i>
            <span>Movimientos</span>
          </h1>
        </div>
      </div>
    </div>
  </section>
  <br>
  <!-- Botones Principales y Offcanvas -->
  <section>
    <div class="container unicion fixed-bottom">
      <div class="body1 d-flex justify-content-center">
        <button id="button1" class="btn btn-primary nueva-venta bg-green" data-bs-toggle="offcanvas" data-bs-target="#venta-libre">
          <img class="image-etiqueta me-3" src="assets/img/Logos Admin/venta.png" alt="">
          Nueva Venta
        </button>
      </div>
      <div class="body2 d-flex justify-content-center">
        <button id="button3" class="btn btn-primary nuevo-gasto" data-bs-toggle="offcanvas" data-bs-target="#gasto" >
          <img class="image-etiqueta me-3" src="assets/img/Logos Admin/gasto.png" alt="">
          Nuevo Gasto
        </button>
        <!-- Offcanvas Venta Libre -->
        <div class="offcanvas offcanvas-start" data-bs-backdrop="static" tabindex="-1" id="venta-libre" aria-labelledby="staticBackdropLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="staticBackdropLabel">Crear Venta Libre</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body" style="padding-left: 8px; padding-right: 8px;">
            <app-add-venta-libre></app-add-venta-libre>
          </div>
        </div>
        <!-- Offcanvas Gasto -->
        <div class="offcanvas offcanvas-start" data-bs-backdrop="static" tabindex="-1" id="gasto" aria-labelledby="staticBackdropLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="staticBackdropLabel">Crear Gasto</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <app-add-gasto></app-add-gasto>
          </div>
        </div>
      </div>
    </div>
  </section>

  <br>
  <section>
    <div class="container unicion ">
      <div class="row">
        <div class="col-sm-12 col-md-6 col-lg-4 d-flex justify-content-center ">
          <div class="balance balances">
            <img class="img-balance " width="100px" src="assets/img/Logos Admin/Balance.png" alt="">
            <div class="balance-precio ">
              <h4>Balance<span *ngIf="showRangeTag"> (en rango)</span></h4>
              <h5><span [ngClass]="{ 'text-success': balance > 0, 'text-danger': balance < 0 }">{{ formatCop(balance) }}</span></h5>
            </div>
          </div>
        </div>
        <div class="col-sm-12 col-md-6 col-lg-4 d-flex justify-content-center ">
          <div class="balance balances">
            <img class="img-balance " width="100px" src="assets/img/Logos Admin/ventas.png" alt="">
            <div class="balance-precio">
              <h4>Ventas Totales<span *ngIf="showRangeTag"> (en rango)</span></h4>
              <h5> <span class="precio_letra">{{ formatCop(ventasTotales) }}</span></h5>
            </div>
          </div>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-4 d-flex justify-content-center ">
          <div class="balance gastos">
            <img class="img-balance" width="105px" src="assets/img/Logos Admin/gastos.png" alt="">
            <div class="balance-precio">
              <h4>Gastos Totales<span *ngIf="showRangeTag"> (en rango)</span></h4>
              <h5> <span class="precio_letra_rojo">{{ formatCop(gastosTotales) }}</span></h5>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <br>
  <!-- Filtros, Calendario, Rango, Buscador, Reporte -->
  <section>
    <div class="container">
      <!-- Desktop Layout -->
      <div class="toolbar-desktop d-none d-lg-flex align-items-center gap-3">
        <!-- Buscador -->
        <div class="flex-grow-1">
          <div class="modern-search-container">
            <div class="search-wrapper">
              <div class="search-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="11" cy="11" r="8"></circle>
                  <path d="m21 21-4.35-4.35"></path>
                </svg>
              </div>
              <input 
                class="modern-search-input" 
                type="search" 
                placeholder="Buscar movimientos..." 
                aria-label="Buscar" 
                [(ngModel)]="searchTerm" 
                name="search" 
                (ngModelChange)="onSearchChange()"
              >
              <div class="search-actions" *ngIf="searchTerm && searchTerm.length > 0">
                <button class="clear-btn" type="button" (click)="clearSearch()">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Filtro -->
        <div class="toolbar-item">
          <div class="dropdown">
            <button class="modern-filter-btn" data-bs-toggle="dropdown" aria-expanded="false" data-bs-auto-close="outside">
              <div class="filter-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                </svg>
              </div>
              <span class="filter-text">Filtros</span>
              <div class="filter-badge"></div>
            </button>
            <div class="dropdown-menu dropdown-menu-end filtro-dropdown-menu" style="min-width: 350px; max-width: 400px; padding: 0;">
              <div class="filtro-dropdown-header">
                <h6 class="mb-0">Filtros avanzados</h6>
                <button type="button" class="btn-close btn-close-sm" data-bs-dismiss="dropdown" aria-label="Close"></button>
              </div>
              <div class="filtro-dropdown-body" style="padding: 15px; max-height: 400px; overflow-y: auto;">
                <app-filter (filtersChange)="applyAdvancedFilters($event)"></app-filter>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Rango de Fechas -->
        <div class="toolbar-item date-range-item">
          <div class="d-flex gap-2">
            <div class="date-input-container">
              <label class="date-label">Desde</label>
              <div class="date-input-wrapper" (click)="dateFromPicker.showPicker()">
                <svg class="date-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                  <line x1="16" y1="2" x2="16" y2="6"></line>
                  <line x1="8" y1="2" x2="8" y2="6"></line>
                  <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
                <input
                  #dateFromPicker
                  type="date"
                  class="modern-date-input"
                  placeholder="Seleccionar fecha"
                  [(ngModel)]="dateFromInput"
                  (change)="setRange('personalizado', true)"
                >
              </div>
            </div>
            <div class="date-input-container">
              <label class="date-label">Hasta</label>
              <div class="date-input-wrapper" (click)="dateToPicker.showPicker()">
                <svg class="date-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                  <line x1="16" y1="2" x2="16" y2="6"></line>
                  <line x1="8" y1="2" x2="8" y2="6"></line>
                  <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
                <input
                  #dateToPicker
                  type="date"
                  class="modern-date-input"
                  placeholder="Seleccionar fecha"
                  [(ngModel)]="dateToInput"
                  (change)="setRange('personalizado', true)"
                >
              </div>
            </div>
          </div>
        </div>
        
        <!-- Rango Dropdown -->
        <div class="toolbar-item">
          <button class="modern-range-btn" data-bs-toggle="dropdown" data-bs-auto-close="outside">
            <div class="range-icon">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 12h18m-9-9v18"></path>
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M12 1v6m0 6v6m11-7h-6m-6 0H1"></path>
              </svg>
            </div>
            <span class="range-text">{{ rangeLabel }}</span>
            <div class="range-arrow">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="6 9 12 15 18 9"></polyline>
              </svg>
            </div>
          </button>
          <div class="dropdown-menu modern-range-dropdown">
            <a class="dropdown-item modern-range-item" [class.active]="!hasRangeApplied" href="#" (click)="clearRange(); $event.preventDefault()">
              <div class="range-item-content">
                <div class="range-item-icon">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="15" y1="9" x2="9" y2="15"></line>
                    <line x1="9" y1="9" x2="15" y2="15"></line>
                  </svg>
                </div>
                <span class="range-item-text">Sin Filtro</span>
              </div>
            </a>
            <a class="dropdown-item modern-range-item" [class.active]="selectedRange === 'diario'" href="#" (click)="setRange('diario'); $event.preventDefault()">
              <div class="range-item-content">
                <div class="range-item-icon">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                  </svg>
                </div>
                <span class="range-item-text">Diario</span>
              </div>
            </a>
            <a class="dropdown-item modern-range-item" [class.active]="selectedRange === 'semanal'" href="#" (click)="setRange('semanal'); $event.preventDefault()">
              <div class="range-item-content">
                <div class="range-item-icon">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M8 2v4m8-4v4M3 10h18"></path>
                    <rect x="3" y="14" width="18" height="8" rx="2"></rect>
                  </svg>
                </div>
                <span class="range-item-text">Semanal</span>
              </div>
            </a>
            <a class="dropdown-item modern-range-item" [class.active]="selectedRange === 'mensual'" href="#" (click)="setRange('mensual'); $event.preventDefault()">
              <div class="range-item-content">
                <div class="range-item-icon">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 7V5a2 2 0 012-2h14a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V7z"></path>
                    <rect x="8" y="11" width="8" height="8" rx="1"></rect>
                  </svg>
                </div>
                <span class="range-item-text">Mensual</span>
              </div>
            </a>
          </div>
        </div>
      </div>
      
      <!-- Tablet Layout -->
      <div class="toolbar-tablet d-none d-md-flex d-lg-none">
        <div class="row g-3">
          <!-- Fila 1: Buscador y Filtros -->
          <div class="col-12">
            <div class="d-flex gap-3">
              <div class="flex-grow-1">
                <div class="modern-search-container">
                  <div class="search-wrapper">
                    <div class="search-icon">
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                      </svg>
                    </div>
                    <input 
                      class="modern-search-input" 
                      type="search" 
                      placeholder="Buscar movimientos..." 
                      aria-label="Buscar" 
                      [(ngModel)]="searchTerm" 
                      name="search" 
                      (ngModelChange)="onSearchChange()"
                    >
                    <div class="search-actions" *ngIf="searchTerm && searchTerm.length > 0">
                      <button class="clear-btn" type="button" (click)="clearSearch()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <line x1="18" y1="6" x2="6" y2="18"></line>
                          <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              <div class="toolbar-item">
                <button class="modern-filter-btn" data-bs-toggle="modal" data-bs-target="#filtroModalTablet">
                  <div class="filter-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                    </svg>
                  </div>
                  <span class="filter-text">Filtros</span>
                  <div class="filter-badge"></div>
                </button>
                <div class="modal fade" id="filtroModalTablet" tabindex="-1" aria-labelledby="filtroModalLabel" aria-hidden="true">
                  <div class="modal-dialog modal-dialog-scrollable modal-lg modal-fullscreen-md-down">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="filtroModalLabel">Filtros avanzados</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                        <app-filter (filtersChange)="applyAdvancedFilters($event)"></app-filter>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Fila 2: Fechas y Rango -->
          <div class="col-12">
            <div class="d-flex gap-3 align-items-center">
              <div class="flex-grow-1">
                <div class="d-flex gap-2">
                  <div class="date-input-container flex-grow-1">
                    <label class="date-label">Desde</label>
                    <div class="date-input-wrapper" (click)="dateFromPicker.showPicker()">
                      <svg class="date-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                      </svg>
                      <input
                        #dateFromPicker
                        type="date"
                        class="modern-date-input"
                        placeholder="Seleccionar fecha"
                        [(ngModel)]="dateFromInput"
                        (change)="setRange('personalizado', true)"
                      >
                    </div>
                  </div>
                  <div class="date-input-container flex-grow-1">
                    <label class="date-label">Hasta</label>
                    <div class="date-input-wrapper" (click)="dateToPicker.showPicker()">
                      <svg class="date-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                      </svg>
                      <input
                        #dateToPicker
                        type="date"
                        class="modern-date-input"
                        placeholder="Seleccionar fecha"
                        [(ngModel)]="dateToInput"
                        (change)="setRange('personalizado', true)"
                      >
                    </div>
                  </div>
                </div>
              </div>
              <div class="toolbar-item">
                <button class="modern-range-btn" data-bs-toggle="dropdown">
                  <div class="range-icon">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M3 12h18m-9-9v18"></path>
                      <circle cx="12" cy="12" r="3"></circle>
                      <path d="M12 1v6m0 6v6m11-7h-6m-6 0H1"></path>
                    </svg>
                  </div>
                  <span class="range-text">{{ rangeLabel }}</span>
                  <div class="range-arrow">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                  </div>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Mobile Layout (Original) -->
      <div class="toolbar-mobile d-md-none">
        <div class="row toolbar-equal">
          <!-- Buscador Moderno -->
          <div class="col-12 col-sm-12 col-md-6 col-lg-3 buscador-reportes">
            <div class="modern-search-container">
              <div class="search-wrapper">
                <div class="search-icon">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                  </svg>
                </div>
                <input 
                  class="modern-search-input" 
                  type="search" 
                  placeholder="Buscar movimientos..." 
                  aria-label="Buscar" 
                  [(ngModel)]="searchTerm" 
                  name="search" 
                  (ngModelChange)="onSearchChange()"
                >
                <div class="search-actions" *ngIf="searchTerm && searchTerm.length > 0">
                  <button class="clear-btn" type="button" (click)="clearSearch()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <line x1="18" y1="6" x2="6" y2="18"></line>
                      <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                  </button>
                </div>
              </div>
            </div>
          </div>
          <!-- Filtro -->
          <div class="col-sm-6 col-md-3 col-lg-2 d-flex justify-content-center text-center ">
            <button class="modern-filter-btn" data-bs-toggle="modal" data-bs-target="#filtroModal">
              <div class="filter-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                </svg>
              </div>
              <span class="filter-text">Filtros</span>
              <div class="filter-badge"></div>
            </button>
            <div class="modal fade" id="filtroModal" tabindex="-1" aria-labelledby="filtroModalLabel" aria-hidden="true">
              <div class="modal-dialog modal-dialog-scrollable modal-lg modal-fullscreen-md-down">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="filtroModalLabel">Filtros avanzados</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <app-filter (filtersChange)="applyAdvancedFilters($event)"></app-filter>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- Rango global Desde / Hasta -->
          <div class="col-sm-12 col-md-6 col-lg-3 d-flex align-items-center date-range-col">
            <div class="w-100 d-flex gap-2 date-range-wrapper">
              <div class="date-input-container">
                <label class="date-label">Desde</label>
                <div class="date-input-wrapper" (click)="dateFromPicker.showPicker()">
                  <svg class="date-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                  </svg>
                  <input
                    #dateFromPicker
                    type="date"
                    class="modern-date-input"
                    placeholder="Seleccionar fecha"
                    [(ngModel)]="dateFromInput"
                    (change)="setRange('personalizado', true)"
                  >
                </div>
              </div>
              <div class="date-input-container">
                <label class="date-label">Hasta</label>
                <div class="date-input-wrapper" (click)="dateToPicker.showPicker()">
                  <svg class="date-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                  </svg>
                  <input
                    #dateToPicker
                    type="date"
                    class="modern-date-input"
                    placeholder="Seleccionar fecha"
                    [(ngModel)]="dateToInput"
                    (change)="setRange('personalizado', true)"
                  >
                </div>
              </div>
            </div>
          </div>
          <!-- Rango -->
          <div class="col-sm-6 col-md-3 col-lg-2 dropdown range-dropdown-col">
            <button class="modern-range-btn" data-bs-toggle="dropdown">
              <div class="range-icon">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M3 12h18m-9-9v18"></path>
                  <circle cx="12" cy="12" r="3"></circle>
                  <path d="M12 1v6m0 6v6m11-7h-6m-6 0H1"></path>
                </svg>
              </div>
              <span class="range-text">{{ rangeLabel }}</span>
              <div class="range-arrow">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </div>
            </button>
            <div class="dropdown-menu modern-range-dropdown">
              <a class="dropdown-item modern-range-item" [class.active]="!hasRangeApplied" href="#" (click)="clearRange(); $event.preventDefault()">
                <div class="range-item-content">
                  <div class="range-item-icon">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <circle cx="12" cy="12" r="10"></circle>
                      <line x1="15" y1="9" x2="9" y2="15"></line>
                      <line x1="9" y1="9" x2="15" y2="15"></line>
                    </svg>
                  </div>
                  <span class="range-item-text">Sin Filtro</span>
                </div>
              </a>
              <a class="dropdown-item modern-range-item" [class.active]="selectedRange === 'diario'" href="#" (click)="setRange('diario'); $event.preventDefault()">
                <div class="range-item-content">
                  <div class="range-item-icon">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                      <line x1="16" y1="2" x2="16" y2="6"></line>
                      <line x1="8" y1="2" x2="8" y2="6"></line>
                      <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                  </div>
                  <span class="range-item-text">Diario</span>
                </div>
              </a>
              <a class="dropdown-item modern-range-item" [class.active]="selectedRange === 'semanal'" href="#" (click)="setRange('semanal'); $event.preventDefault()">
                <div class="range-item-content">
                  <div class="range-item-icon">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M8 2v4m8-4v4M3 10h18"></path>
                      <rect x="3" y="14" width="18" height="8" rx="2"></rect>
                    </svg>
                  </div>
                  <span class="range-item-text">Semanal</span>
                </div>
              </a>
              <a class="dropdown-item modern-range-item" [class.active]="selectedRange === 'mensual'" href="#" (click)="setRange('mensual'); $event.preventDefault()">
                <div class="range-item-content">
                  <div class="range-item-icon">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M3 7V5a2 2 0 012-2h14a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V7z"></path>
                      <rect x="8" y="11" width="8" height="8" rx="1"></rect>
                    </svg>
                  </div>
                  <span class="range-item-text">Mensual</span>
                </div>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <br>
  <!-- Selecciones de Ventas -->
  <section>
    <div class="container unicion">
      <div class="row">
        <div class="col">
          <div class="d-flex align-items-center justify-content-center">
            <button class="seleccion" (click)="selectTab('ingresos')" [class.active]="selectedTab==='ingresos'">Ingresos<span *ngIf="showRangeTag" class="text-primary small ms-1">(en rango)</span></button>
          </div>
        </div>
        <div class="col">
          <div class="d-flex align-items-center justify-content-center">
            <button class="seleccion" (click)="selectTab('egresos')" [class.active]="selectedTab==='egresos'">Egresos<span *ngIf="showRangeTag" class="text-primary small ms-1">(en rango)</span></button>
          </div>
        </div>
        <div class="col">
          <div class="d-flex align-items-center justify-content-center">
            <button class="seleccion" (click)="selectTab('por_cobrar')" [class.active]="selectedTab==='por_cobrar'">Por Cobrar<span *ngIf="showRangeTag" class="text-primary small ms-1">(en rango)</span></button>
          </div>
        </div>
        <div class="col">
          <div class="d-flex align-items-center justify-content-center">
            <button class="seleccion" (click)="selectTab('por_pagar')" [class.active]="selectedTab==='por_pagar'">Por Pagar<span *ngIf="showRangeTag" class="text-primary small ms-1">(en rango)</span></button>
          </div>
        </div>
      </div>
      <div class="row mt-2">
        <div class="col d-flex justify-content-end">
          <button
            type="button"
            class="btn chip-btn d-inline-flex align-items-center report-export-btn"
            (click)="exportCurrentTab()"
            [disabled]="
              (selectedTab==='ingresos' && ventasIngresos.length === 0) ||
              (selectedTab==='egresos' && gastosEgresos.length === 0) ||
              (selectedTab==='por_cobrar' && ventasPorCobrar.length === 0) ||
              (selectedTab==='por_pagar' && gastosPorPagar.length === 0)
            "
          >
            <img class="icon-quick" src="assets/img/Logos Admin/xls.png" alt="">
            <span>Reporte</span>
          </button>
        </div>
      </div>
    </div>
  </section><br>
  
  <!-- Tabla Ingresos -->
  <section *ngIf="selectedTab==='ingresos'">
    <div class="container">
      <div class="row">
        <table class="table table-hover align-middle shadow-sm rounded overflow-hidden">
          <thead class="table-light">
            <tr>
              <th>Nombre Productos</th>
              <th class="text-end">Valor</th>
              <th class="ocultar-en-movil">Medio de Pago</th>
              <th class="ocultar-en-movil">Fecha y Hora</th>
              <th class="ocultar-en-movil">Estado</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let v of ventasIngresos" class="table-row-click" (click)="abrirDialogoVenta(v)">
              <td data-label="Nombre Productos">
                <div class="producto-resumen d-flex gap-2 align-items-center">
                  <img src="assets/img/Logos Admin/ventas.png" alt="" class="img-responsive" width="36" height="36">
                  <div class="info-producto d-flex flex-column">
                    <span class="nom_produc fw-semibold text-truncate" style="max-width: 240px;">
                      {{ (v.tipo_venta || '') === 'libre' ? ('Venta Libre #' + (v.id || '')) : ('Venta #' + (v.id || '')) }}
                    </span>
                    <small class="text-muted" *ngIf="isEmpleadoVenta(v)">
                      Por: {{ empleadoNombreById(getUsuarioIdFromVenta(v)) }}
                      <span> • Turno: {{ getTurnoIdFromVenta(v) || '—' }}</span>
                    </small>
                    <small class="text-muted d-md-none">{{ v.forma_pago || '-' }} • {{ v.fecha_hora | date:'dd/MM/yyyy | hh:mm a' }}</small>
                  </div>
                </div>
              </td>
              <td class="valo text-end" data-label="Valor">
                <span *ngIf="v.descuentoPorcentaje" class="badge text-bg-danger me-2">-{{ v.descuentoPorcentaje }}%</span>
                <span class="valor-derecha fw-bold text-success">{{ v.total | currency:'COP':'symbol-narrow':'1.0-0' }}</span>
              </td>
              <td class="ocultar-en-movil" data-label="Medio de Pago">
                <span>{{ v.forma_pago || '-' }}</span>
                <br *ngIf="v.transaccionId">
                <small class="text-muted" *ngIf="v.transaccionId">ID: {{ v.transaccionId }}</small>
              </td>
              <td class="ocultar-en-movil" data-label="Fecha y Hora">{{ v.fecha_hora | date:'dd/MM/yyyy | hh:mm a' }}</td>
              <td class="ocultar-en-movil" data-label="Estado">
                <span
                  class="status"
                  [ngClass]="{
                    'bg-success-subtle text-success': (v.estado||'').toLowerCase()==='confirmado' || (v.estado||'').toLowerCase()==='confirmada',
                    'bg-primary-subtle text-primary': (v.estado||'').toLowerCase()==='pendiente' || !(v.estado||'').trim(),
                    'text-muted': ['confirmado','confirmada','pendiente',''].indexOf((v.estado||'').toLowerCase()) === -1
                  }"
                >{{ v.estado || 'Confirmado' }}</span>
              </td>
            </tr>
            <tr *ngIf="ventasIngresos.length === 0">
              <td colspan="5" class="text-center text-muted py-4">
                {{ (searchTerm || '').trim()
                    ? ('No se encontró ninguna Venta para "' + (searchTerm || '').trim() + '".')
                    : 'No hay Ventas Registradas' }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- Tabla Gastos -->
  <section *ngIf="selectedTab==='egresos'">
    <div class="container">
      <div class="row">
        <table class="table table-hover align-middle shadow-sm rounded overflow-hidden">
          <thead class="table-light">
            <tr>
              <th>Nombre</th>
              <th class="ocultar-en-movil">Descripción</th>
              <th class="text-end">Monto</th>
              <th class="ocultar-en-movil">Medio de Pago</th>
              <th class="ocultar-en-movil">Fecha</th>
              <th class="ocultar-en-movil">Estado</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let g of gastosEgresos" class="table-row-click" (click)="abrirDialogoGasto(g)" style="cursor: pointer;">
              <td data-label="Nombre">
                <div class="producto-resumen d-flex gap-2 align-items-center">
                  <img src="assets/img/Logos Admin/gastos.png" alt="" class="img-responsive" width="36" height="36">
                  <div class="info-producto d-flex flex-column">
                    <span class="nom_produc fw-semibold text-truncate" style="max-width: 240px;">{{ g.nombre || ('Gasto #' + g.id) }}</span>
                    <small class="text-muted" *ngIf="isEmpleadoGasto(g)">
                      Por: {{ empleadoNombreById(getUsuarioIdFromGasto(g)) }}
                      <span> • Turno: {{ getTurnoIdFromGasto(g) || '—' }}</span>
                    </small>
                    <small class="text-muted d-md-none">{{ g.forma_pago || '-' }} • {{ g.fecha | date:'dd/MM/yyyy' }}</small>
                  </div>
                </div>
              </td>
              <td class="ocultar-en-movil" data-label="Descripción">
                <span class="text-truncate" style="max-width: 260px; display: inline-block;">{{ g.descripcion || '-' }}</span>
              </td>
              <td class="valo text-end" data-label="Monto">
                <span class="valor-derecha fw-bold text-danger">{{ (g.monto || 0) | currency:'COP':'symbol-narrow':'1.0-0' }}</span>
              </td>
              <td class="ocultar-en-movil" data-label="Medio de Pago">
                <span>{{ g.forma_pago || '-' }}</span>
                <br *ngIf="g.transaccionId">
                <small class="text-muted" *ngIf="g.transaccionId">ID: {{ g.transaccionId }}</small>
              </td>
              <td class="ocultar-en-movil" data-label="Fecha">{{ g.fecha | date:'dd/MM/yyyy' }}</td>
              <td class="ocultar-en-movil" data-label="Estado">
                <span
                  class="status"
                  [ngClass]="{
                    'bg-success-subtle text-success': (g.estado||'').toLowerCase()==='confirmado',
                    'bg-primary-subtle text-primary': (g.estado||'').toLowerCase()==='pendiente',
                    'text-muted': ['confirmado','pendiente'].indexOf((g.estado||'').toLowerCase()) === -1
                  }"
                >{{ g.estado }}</span>
              </td>
            </tr>
            <tr *ngIf="gastosEgresos.length === 0">
              <td colspan="6" class="text-center text-muted py-4">
                {{ (searchTerm || '').trim()
                    ? ('No se encontró ningún Gasto para "' + (searchTerm || '').trim() + '".')
                    : 'No hay Gastos Registrados' }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- Tabla Por Cobrar (Ventas pendientes) -->
  <section *ngIf="selectedTab==='por_cobrar'">
    <div class="container">
      <div class="row">
        <table class="table table-hover align-middle shadow-sm rounded overflow-hidden">
          <thead class="table-light">
            <tr>
              <th>Nombre Productos</th>
              <th class="text-end">Valor</th>
              <th class="ocultar-en-movil">Medio de Pago</th>
              <th class="ocultar-en-movil">Fecha y Hora</th>
              <th class="ocultar-en-movil">Estado</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let v of ventasPorCobrar" class="table-row-click" (click)="abrirDialogoVenta(v)">
              <td data-label="Nombre Productos">
                <div class="producto-resumen d-flex gap-2 align-items-center">
                  <img src="assets/img/Logos Admin/ventas.png" alt="" class="img-responsive" width="36" height="36">
                  <div class="info-producto d-flex flex-column">
                    <span class="nom_produc fw-semibold text-truncate" style="max-width: 240px;">
                      {{ (v.tipo_venta || '') === 'libre' ? ('Venta Libre #' + (v.id || '')) : ('Venta #' + (v.id || '')) }}
                    </span>
                    <small class="text-muted" *ngIf="isEmpleadoVenta(v)">
                      Por: {{ empleadoNombreById(getUsuarioIdFromVenta(v)) }}
                      <span> • Turno: {{ getTurnoIdFromVenta(v) || '—' }}</span>
                    </small>
                    <small class="text-muted d-md-none">{{ v.forma_pago || '-' }} • {{ v.fecha_hora | date:'dd/MM/yyyy | hh:mm a' }}</small>
                  </div>
                </div>
              </td>
              <td class="valo text-end" data-label="Valor">
                <span *ngIf="v.descuentoPorcentaje" class="badge text-bg-danger me-2">-{{ v.descuentoPorcentaje }}%</span>
                <span class="valor-derecha fw-bold text-success">{{ v.total | currency:'COP':'symbol-narrow':'1.0-0' }}</span>
              </td>
              <td class="ocultar-en-movil" data-label="Medio de Pago">{{ v.forma_pago || '-' }}</td>
              <td class="ocultar-en-movil" data-label="Fecha y Hora">{{ v.fecha_hora | date:'dd/MM/yyyy | hh:mm a' }}</td>
              <td class="ocultar-en-movil" data-label="Estado">
                <span
                  class="status"
                  [ngClass]="{
                    'bg-success-subtle text-success': (v.estado||'').toLowerCase()==='confirmado',
                    'bg-primary-subtle text-primary': (v.estado||'').toLowerCase()==='pendiente' || !(v.estado||'').trim(),
                    'text-muted': ['confirmado','pendiente',''].indexOf((v.estado||'').toLowerCase()) === -1
                  }"
                >{{ v.estado || 'Pendiente' }}</span>
              </td>
            </tr>
            <tr *ngIf="ventasPorCobrar.length === 0">
              <td colspan="5" class="text-center text-muted py-4">
                {{ (searchTerm || '').trim()
                    ? ('No se encontraron Ventas Pendientes por Cobrar para "' + (searchTerm || '').trim() + '".')
                    : 'No hay Ventas Pendientes por Cobrar' }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- Tabla Por Pagar (Gastos pendientes) -->
  <section *ngIf="selectedTab==='por_pagar'">
    <div class="container">
      <div class="row">
        <table class="table table-hover align-middle shadow-sm rounded overflow-hidden">
          <thead class="table-light">
            <tr>
              <th>Nombre</th>
              <th class="ocultar-en-movil">Descripción</th>
              <th class="text-end">Monto</th>
              <th class="ocultar-en-movil">Medio de Pago</th>
              <th class="ocultar-en-movil">Fecha</th>
              <th class="ocultar-en-movil">Estado</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let g of gastosPorPagar" class="table-row-click" (click)="abrirDialogoGasto(g)" style="cursor: pointer;">
              <td data-label="Nombre">
                <div class="producto-resumen d-flex gap-2 align-items-center">
                  <img src="assets/img/Logos Admin/gastos.png" alt="" class="img-responsive" width="36" height="36">
                  <div class="info-producto d-flex flex-column">
                    <span class="nom_produc fw-semibold text-truncate" style="max-width: 240px;">{{ g.nombre || ('Gasto #' + g.id) }}</span>
                    <small class="text-muted" *ngIf="isEmpleadoGasto(g)">
                      Por: {{ empleadoNombreById(getUsuarioIdFromGasto(g)) }}
                      <span> • Turno: {{ getTurnoIdFromGasto(g) || '—' }}</span>
                    </small>
                    <small class="text-muted d-md-none">{{ g.forma_pago || '-' }} • {{ g.fecha | date:'dd/MM/yyyy' }}</small>
                  </div>
                </div>
              </td>
              <td class="ocultar-en-movil" data-label="Descripción">
                <span class="text-truncate" style="max-width: 260px; display: inline-block;">{{ g.descripcion || '-' }}</span>
              </td>
              <td class="valo text-end" data-label="Monto">
                <span class="valor-derecha fw-bold text-danger">{{ (g.monto || 0) | currency:'COP':'symbol-narrow':'1.0-0' }}</span>
              </td>
              <td class="ocultar-en-movil" data-label="Medio de Pago">{{ g.forma_pago || '-' }}</td>
              <td class="ocultar-en-movil" data-label="Fecha">{{ g.fecha | date:'dd/MM/yyyy' }}</td>
              <td class="ocultar-en-movil" data-label="Estado">
                <span
                  class="status"
                  [ngClass]="{
                    'bg-success-subtle text-success': (g.estado||'').toLowerCase()==='confirmado',
                    'bg-primary-subtle text-primary': (g.estado||'').toLowerCase()==='pendiente' || !(g.estado||'').trim(),
                    'text-muted': ['confirmado','pendiente',''].indexOf((g.estado||'').toLowerCase()) === -1
                  }"
                >{{ g.estado || 'Pendiente' }}</span>
              </td>
            </tr>
            <tr *ngIf="gastosPorPagar.length === 0">
              <td colspan="6" class="text-center text-muted py-4">
                {{ (searchTerm || '').trim()
                    ? ('No se encontraron Gastos Pendientes por Pagar para "' + (searchTerm || '').trim() + '".')
                    : 'No hay Gastos Pendientes por Pagar' }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>
</div>
<app-agente-ia></app-agente-ia>